#=======================================
# LOGGING
#=======================================
quarkus.log.level=INFO
quarkus.log.category."org.jboss.sbomer".level=DEBUG

#=======================================
# Quarkus Datasource
#=======================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USERNAME:sbomer}
quarkus.datasource.password=${DB_PASSWORD:password}

# Leaving it unset in %dev triggers Dev Services (automatic container).
%prod.quarkus.datasource.jdbc.url=${DB_URL:jdbc:postgresql://localhost:5432/sbomer}

#=======================================
# MIGRATION (Flyway)
#=======================================
# 1. Run the migration automatically on startup
quarkus.flyway.migrate-at-start=true

# 2. Safety net: If DB is not empty but has no history, baseline it (don't crash)
quarkus.flyway.baseline-on-migrate=true

#=======================================
# HIBERNATE (Passive)
#=======================================

# Validate that the DB matches the Java entities on startup
# If Flyway missed a column or made a typo, the app CRASHES immediately on startup.
# This prevents data corruption later.
quarkus.hibernate-orm.schema-management.strategy=validate

# DEV ONLY: Load test data after Flyway finishes
%dev.quarkus.hibernate-orm.sql-load-script=import.sql

#=======================================
# APPLICATION & HTTP
#=======================================
# Use port 8080 in dev mode to avoid conflicts with 8080 (Minikube gateway)
%dev.quarkus.http.port=8080

# CORS configuration for local UI development (port 9000)
%dev.quarkus.http.cors.enabled=true
%dev.quarkus.http.cors.origins=http://localhost:9000
%dev.quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
%dev.quarkus.http.cors.headers=Content-Type,Authorization,Accept

# OpenAPI and Swagger UI
quarkus.smallrye-openapi.path=/q/openapi
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/q/swagger-ui

mp.openapi.scan.disable=false
mp.openapi.servers=/
mp.openapi.info.title=SBOMer Service API
mp.openapi.info.version=1.0.0
mp.openapi.info.description=API for triggering and managing SBOM generations.

#=======================================
# KAFKA - GLOBAL CONFIG
#=======================================
# Move placeholders to %prod so Dev Services can start its own Kafka container in dev mode.
kafka.apicurio.registry.auto-register=true
%prod.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS}
%prod.kafka.apicurio.registry.url=${SCHEMA_REGISTRY_URL}

#=======================================
# KAFKA - CHANNEL DEFINITIONS
#=======================================

# --- INCOMING ---
mp.messaging.incoming.requests-created.topic=requests.created
mp.messaging.incoming.requests-created.connector=smallrye-kafka
mp.messaging.incoming.requests-created.value.deserializer=io.apicurio.registry.serde.avro.AvroKafkaDeserializer
mp.messaging.incoming.requests-created.group.id=sbomer-requests-group
mp.messaging.incoming.requests-created.apicurio.registry.use-specific-avro-reader=true

mp.messaging.incoming.generation-update.topic=generation.update
mp.messaging.incoming.generation-update.connector=smallrye-kafka
mp.messaging.incoming.generation-update.value.deserializer=io.apicurio.registry.serde.avro.AvroKafkaDeserializer
mp.messaging.incoming.generation-update.group.id=sbomer-generation-group
mp.messaging.incoming.generation-update.apicurio.registry.use-specific-avro-reader=true

mp.messaging.incoming.enhancement-update.topic=enhancement.update
mp.messaging.incoming.enhancement-update.connector=smallrye-kafka
mp.messaging.incoming.enhancement-update.value.deserializer=io.apicurio.registry.serde.avro.AvroKafkaDeserializer
mp.messaging.incoming.enhancement-update.group.id=sbomer-enhancement-group
mp.messaging.incoming.enhancement-update.apicurio.registry.use-specific-avro-reader=true

# --- OUTGOING ---
mp.messaging.outgoing.generation-created.topic=generation.created
mp.messaging.outgoing.generation-created.connector=smallrye-kafka
mp.messaging.outgoing.generation-created.value.serializer=io.apicurio.registry.serde.avro.AvroKafkaSerializer

mp.messaging.outgoing.enhancement-created.topic=enhancement.created
mp.messaging.outgoing.enhancement-created.connector=smallrye-kafka
mp.messaging.outgoing.enhancement-created.value.serializer=io.apicurio.registry.serde.avro.AvroKafkaSerializer

mp.messaging.outgoing.requests-finished.topic=requests.finished
mp.messaging.outgoing.requests-finished.connector=smallrye-kafka
mp.messaging.outgoing.requests-finished.value.serializer=io.apicurio.registry.serde.avro.AvroKafkaSerializer

mp.messaging.outgoing.sbomer-errors.topic=sbomer.errors
mp.messaging.outgoing.sbomer-errors.connector=smallrye-kafka
mp.messaging.outgoing.sbomer-errors.value.serializer=io.apicurio.registry.serde.avro.AvroKafkaSerializer
